/// @file AudioFrame.swift
/// @brief ë””ì½”ë”©ëœ ì˜¤ë””ì˜¤ í”„ë ˆì„ ë°ì´í„° ëª¨ë¸
/// @author BlackboxPlayer Development Team
/// @details
/// FFmpegì—ì„œ ë””ì½”ë”©í•œ ì›ì‹œ ì˜¤ë””ì˜¤ ë°ì´í„°(PCM)ë¥¼ ë‹´ëŠ” êµ¬ì¡°ì²´ì…ë‹ˆë‹¤.
/// ë¹„ë””ì˜¤ íŒŒì¼ì˜ MP3/AAC ë“± ì••ì¶•ëœ ì˜¤ë””ì˜¤ë¥¼ ë””ì½”ë”©í•˜ë©´ PCM(Pulse Code Modulation) í˜•íƒœì˜
/// ì›ì‹œ ì˜¤ë””ì˜¤ ë°ì´í„°ê°€ ìƒì„±ë˜ëŠ”ë°, ì´ë¥¼ í”„ë ˆì„ ë‹¨ìœ„ë¡œ ê´€ë¦¬í•©ë‹ˆë‹¤.
///
/// [ì´ íŒŒì¼ì˜ ì—­í• ]
/// FFmpegì—ì„œ ë””ì½”ë”©í•œ ì›ì‹œ ì˜¤ë””ì˜¤ ë°ì´í„°(PCM)ë¥¼ ë‹´ëŠ” êµ¬ì¡°ì²´ì…ë‹ˆë‹¤.
/// ë¹„ë””ì˜¤ íŒŒì¼ì˜ MP3/AAC ë“± ì••ì¶•ëœ ì˜¤ë””ì˜¤ë¥¼ ë””ì½”ë”©í•˜ë©´ PCM(Pulse Code Modulation) í˜•íƒœì˜
/// ì›ì‹œ ì˜¤ë””ì˜¤ ë°ì´í„°ê°€ ìƒì„±ë˜ëŠ”ë°, ì´ë¥¼ í”„ë ˆì„ ë‹¨ìœ„ë¡œ ê´€ë¦¬í•©ë‹ˆë‹¤.
///
/// [ì˜¤ë””ì˜¤ í”„ë ˆì„ì´ë€?]
/// ì˜¤ë””ì˜¤ë„ ë¹„ë””ì˜¤ì²˜ëŸ¼ "í”„ë ˆì„" ë‹¨ìœ„ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤:
/// - ë¹„ë””ì˜¤ í”„ë ˆì„ = í•œ ì¥ì˜ ì´ë¯¸ì§€
/// - ì˜¤ë””ì˜¤ í”„ë ˆì„ = ì¼ì • ê°œìˆ˜ì˜ ì˜¤ë””ì˜¤ ìƒ˜í”Œ ë¬¶ìŒ (ë³´í†µ 1024ê°œ)
///
/// ì˜ˆì‹œ:
/// - ìƒ˜í”Œë ˆì´íŠ¸ 48000Hz (1ì´ˆì— 48000ê°œ ìƒ˜í”Œ)
/// - í”„ë ˆì„ë‹¹ 1024 ìƒ˜í”Œ
/// - í”„ë ˆì„ ì§€ì†ì‹œê°„ = 1024 / 48000 = ì•½ 21ms
///
/// [PCM (Pulse Code Modulation)ì´ë€?]
/// ì•„ë‚ ë¡œê·¸ ì†Œë¦¬ë¥¼ ë””ì§€í„¸ë¡œ ë³€í™˜í•œ ê°€ì¥ ê¸°ë³¸ì ì¸ í˜•íƒœ:
///
/// ì•„ë‚ ë¡œê·¸ ì†Œë¦¬íŒŒ  â†’  ìƒ˜í”Œë§  â†’  ì–‘ìí™”  â†’  PCM ë°ì´í„°
///  (ì—°ì† íŒŒí˜•)      (1ì´ˆì— Në²ˆ)  (ìˆ«ìë¡œ ë³€í™˜)  ([-1.0, 0.5, -0.3, ...])
///
/// ìŒì§ˆì„ ê²°ì •í•˜ëŠ” ìš”ì†Œ:
/// 1. ìƒ˜í”Œë ˆì´íŠ¸: 1ì´ˆì— ëª‡ ë²ˆ ì¸¡ì •í•˜ëŠ”ê°€? (44.1kHz, 48kHz ë“±)
/// 2. ë¹„íŠ¸ ê¹Šì´: ê° ìƒ˜í”Œì„ ëª‡ ë¹„íŠ¸ë¡œ í‘œí˜„í•˜ëŠ”ê°€? (16bit, 32bit ë“±)
/// 3. ì±„ë„ ìˆ˜: ëª¨ë…¸(1)? ìŠ¤í…Œë ˆì˜¤(2)? 5.1ì±„ë„(6)?
///
/// [ë°ì´í„° íë¦„]
/// 1. VideoDecoderê°€ FFmpegë¡œ MP3 ë””ì½”ë”© â†’ PCM ë°ì´í„° ìƒì„±
/// 2. AudioFrame êµ¬ì¡°ì²´ì— PCM ë°ì´í„° + ë©”íƒ€ì •ë³´ ì €ì¥
/// 3. AudioPlayerê°€ AudioFrameì„ AVAudioPCMBufferë¡œ ë³€í™˜
/// 4. AVAudioEngineì´ ìŠ¤í”¼ì»¤ë¡œ ì¬ìƒ
///
/// MP3 íŒŒì¼ (ì••ì¶•) â†’ FFmpeg ë””ì½”ë”© â†’ AudioFrame (PCM) â†’ AVAudioPCMBuffer â†’ ğŸ”Š ì¬ìƒ
///

import Foundation
import AVFoundation

// MARK: - AudioFrame êµ¬ì¡°ì²´

/// @struct AudioFrame
/// @brief ë””ì½”ë”©ëœ ì˜¤ë””ì˜¤ í”„ë ˆì„ (PCM ìƒ˜í”Œ ë°ì´í„°)
///
/// @details
/// FFmpegì—ì„œ ë””ì½”ë”©í•œ ì›ì‹œ ì˜¤ë””ì˜¤ ë°ì´í„°ë¥¼ Swiftì—ì„œ ë‹¤ë£¨ê¸° ì‰½ê²Œ í¬ì¥í•œ êµ¬ì¡°ì²´ì…ë‹ˆë‹¤.
/// ì´ êµ¬ì¡°ì²´ëŠ” ë‹¤ìŒ ì •ë³´ë¥¼ í¬í•¨í•©ë‹ˆë‹¤:
/// - íƒ€ì„ìŠ¤íƒ¬í”„: ì´ ì˜¤ë””ì˜¤ê°€ ë¹„ë””ì˜¤ì˜ ëª‡ ì´ˆ ì§€ì ì¸ê°€?
/// - ì˜¤ë””ì˜¤ í¬ë§·: ìƒ˜í”Œë ˆì´íŠ¸, ì±„ë„ ìˆ˜, ë°ì´í„° í˜•ì‹
/// - PCM ë°ì´í„°: ì‹¤ì œ ì˜¤ë””ì˜¤ ìƒ˜í”Œ ê°’ë“¤
///
/// ## ì‚¬ìš© ì˜ˆì‹œ
/// ```swift
/// // FFmpegì—ì„œ ë””ì½”ë”©ëœ ì˜¤ë””ì˜¤ í”„ë ˆì„ ìƒì„±
/// let frame = AudioFrame(
///     timestamp: 1.5,              // ë¹„ë””ì˜¤ 1.5ì´ˆ ì§€ì 
///     sampleRate: 48000,           // 48kHz (CD í’ˆì§ˆ)
///     channels: 2,                 // ìŠ¤í…Œë ˆì˜¤
///     format: .floatPlanar,        // 32ë¹„íŠ¸ float, planar ë°°ì¹˜
///     data: pcmData,               // ì‹¤ì œ PCM ë°”ì´íŠ¸
///     sampleCount: 1024            // 1024ê°œ ìƒ˜í”Œ
/// )
///
/// // ì¬ìƒì„ ìœ„í•´ AVAudioPCMBufferë¡œ ë³€í™˜
/// if let buffer = frame.toAudioBuffer() {
///     audioPlayer.enqueue(buffer)  // ì¬ìƒ íì— ì¶”ê°€
/// }
/// ```
///
/// ## Planar vs Interleaved ë°°ì¹˜
/// ìŠ¤í…Œë ˆì˜¤(2ì±„ë„) ì˜¤ë””ì˜¤ ë°ì´í„°ë¥¼ ë©”ëª¨ë¦¬ì— ë°°ì¹˜í•˜ëŠ” ë‘ ê°€ì§€ ë°©ì‹:
///
/// **Interleaved (êµì°¨ ë°°ì¹˜)**: LRLRLRLR...
/// ```
/// [L0, R0, L1, R1, L2, R2, L3, R3, ...]
///  ì™¼ìª½0, ì˜¤ë¥¸ìª½0, ì™¼ìª½1, ì˜¤ë¥¸ìª½1...
/// ```
/// - ì¥ì : ë©”ëª¨ë¦¬ ì—°ì†ì„±, ìºì‹œ íš¨ìœ¨ ì¢‹ìŒ
/// - ë‹¨ì : ì±„ë„ë³„ ì²˜ë¦¬ ì‹œ stride í•„ìš”
///
/// **Planar (í‰ë©´ ë°°ì¹˜)**: LLL...RRR...
/// ```
/// [L0, L1, L2, L3, ...] [R0, R1, R2, R3, ...]
///  ì™¼ìª½ ì±„ë„ ì „ì²´        ì˜¤ë¥¸ìª½ ì±„ë„ ì „ì²´
/// ```
/// - ì¥ì : ì±„ë„ë³„ ì²˜ë¦¬ ì‰¬ì›€ (DSP, ì´í™íŠ¸)
/// - ë‹¨ì : ë©”ëª¨ë¦¬ ë¶„ì‚°
///
/// FFmpegëŠ” ë³´í†µ Planar í˜•ì‹ìœ¼ë¡œ ë””ì½”ë”©í•˜ê³ ,
/// AVAudioEngineëŠ” Interleavedë¥¼ ì„ í˜¸í•©ë‹ˆë‹¤.
/// ì´ êµ¬ì¡°ì²´ê°€ ë³€í™˜ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤.
struct AudioFrame {
    // MARK: - Properties

    /// @var timestamp
    /// @brief í”„ë ˆì  í…Œì´ì…˜ íƒ€ì„ìŠ¤íƒ¬í”„ (ì´ˆ ë‹¨ìœ„)
    ///
    /// @details
    /// ì´ ì˜¤ë””ì˜¤ í”„ë ˆì„ì´ ë¹„ë””ì˜¤ì˜ ëª‡ ì´ˆ ì§€ì ì—ì„œ ì¬ìƒë˜ì–´ì•¼ í•˜ëŠ”ì§€ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
    ///
    /// **ì™œ í•„ìš”í•œê°€?**
    /// ì˜¤ë””ì˜¤ì™€ ë¹„ë””ì˜¤ì˜ ë™ê¸°í™”(Lip Sync)ë¥¼ ë§ì¶”ê¸° ìœ„í•´ í•„ìˆ˜ì ì…ë‹ˆë‹¤.
    ///
    /// **ì˜ˆì‹œ**:
    /// ```
    /// Frame 1: timestamp = 0.000ì´ˆ (ì‹œì‘)
    /// Frame 2: timestamp = 0.021ì´ˆ (21ms í›„)
    /// Frame 3: timestamp = 0.043ì´ˆ (43ms í›„)
    /// ...
    /// ```
    ///
    /// ë¹„ë””ì˜¤ í”„ë ˆì„ì˜ íƒ€ì„ìŠ¤íƒ¬í”„ì™€ ì˜¤ë””ì˜¤ í”„ë ˆì„ì˜ íƒ€ì„ìŠ¤íƒ¬í”„ë¥¼ ë¹„êµí•˜ì—¬
    /// ë™ê¸°í™”ë¥¼ ë§ì¶¥ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´:
    /// - ë¹„ë””ì˜¤ í”„ë ˆì„: 1.500ì´ˆ
    /// - ì˜¤ë””ì˜¤ í”„ë ˆì„: 1.498ì´ˆ â†’ ê±°ì˜ ì¼ì¹˜ (Â±2ms ì´ë‚´)
    let timestamp: TimeInterval

    /// @var sampleRate
    /// @brief ìƒ˜í”Œë ˆì´íŠ¸ (ì´ˆë‹¹ ìƒ˜í”Œ ìˆ˜)
    ///
    /// @details
    /// 1ì´ˆì— ëª‡ ê°œì˜ ì˜¤ë””ì˜¤ ìƒ˜í”Œì„ ì¸¡ì •í•˜ëŠ”ê°€ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
    /// ë†’ì„ìˆ˜ë¡ ê³ ìŒì§ˆì´ì§€ë§Œ, ë°ì´í„° í¬ê¸°ë„ ì¦ê°€í•©ë‹ˆë‹¤.
    ///
    /// **ì¼ë°˜ì ì¸ ìƒ˜í”Œë ˆì´íŠ¸**:
    /// - 8000 Hz: ì „í™” í’ˆì§ˆ (ë‚®ì€ ìŒì§ˆ, ìŒì„± í†µí™”ìš©)
    /// - 22050 Hz: ë¼ë””ì˜¤ í’ˆì§ˆ (ì¤‘ê°„ ìŒì§ˆ)
    /// - 44100 Hz: CD í’ˆì§ˆ (í‘œì¤€ ìŒì•… í’ˆì§ˆ) â­
    /// - 48000 Hz: DVD/ë¸”ë£¨ë ˆì´ í’ˆì§ˆ (ë¹„ë””ì˜¤ í‘œì¤€) â­â­
    /// - 96000 Hz: ê³ í•´ìƒë„ ì˜¤ë””ì˜¤ (ìŠ¤íŠœë””ì˜¤ í’ˆì§ˆ)
    ///
    /// **ë‚˜ì´í€´ìŠ¤íŠ¸ ì •ë¦¬**:
    /// ì¸ê°„ì´ ë“¤ì„ ìˆ˜ ìˆëŠ” ìµœê³  ì£¼íŒŒìˆ˜ëŠ” ì•½ 20kHzì…ë‹ˆë‹¤.
    /// ì´ë¥¼ ì •í™•íˆ ì¬í˜„í•˜ë ¤ë©´ ìµœì†Œ 40kHzì˜ ìƒ˜í”Œë ˆì´íŠ¸ê°€ í•„ìš”í•©ë‹ˆë‹¤.
    /// (ìƒ˜í”Œë ˆì´íŠ¸ â‰¥ 2 Ã— ìµœëŒ€ ì£¼íŒŒìˆ˜)
    /// ê·¸ë˜ì„œ CDëŠ” 44.1kHzë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
    ///
    /// **ì˜ˆì‹œ**:
    /// ```
    /// sampleRate = 48000 Hz
    /// â†’ 1ì´ˆ = 48,000ê°œ ìƒ˜í”Œ
    /// â†’ 1ms = 48ê°œ ìƒ˜í”Œ
    /// â†’ 1ê°œ ìƒ˜í”Œ = 0.0208ms
    /// ```
    let sampleRate: Int

    /// @var channels
    /// @brief ì˜¤ë””ì˜¤ ì±„ë„ ìˆ˜
    ///
    /// @details
    /// ì˜¤ë””ì˜¤ê°€ ëª‡ ê°œì˜ ë…ë¦½ì ì¸ ì‹ í˜¸ ì±„ë„ì„ ê°€ì§€ëŠ”ê°€ë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
    ///
    /// **ì±„ë„ êµ¬ì„±**:
    /// - 1 ì±„ë„ = Mono (ëª¨ë…¸): ë‹¨ì¼ ìŠ¤í”¼ì»¤, ìŒì„± ë…¹ìŒ
    /// - 2 ì±„ë„ = Stereo (ìŠ¤í…Œë ˆì˜¤): ì¢Œ/ìš° ë¶„ë¦¬, ìŒì•…/ì˜í™” í‘œì¤€ â­
    /// - 4 ì±„ë„ = Quad (ì¿¼ë“œ): ì „/í›„ + ì¢Œ/ìš°
    /// - 5.1 ì±„ë„ = í™ˆì‹œì–´í„°: ì „ë°© 3ê°œ + í›„ë°© 2ê°œ + ì„œë¸Œìš°í¼
    /// - 7.1 ì±„ë„ = ê³ ê¸‰ í™ˆì‹œì–´í„°: ì „ë°© 3ê°œ + ì¸¡ë©´ 2ê°œ + í›„ë°© 2ê°œ + ì„œë¸Œìš°í¼
    ///
    /// ë¸”ë™ë°•ìŠ¤ëŠ” ë³´í†µ 1ì±„ë„(ëª¨ë…¸) ë˜ëŠ” 2ì±„ë„(ìŠ¤í…Œë ˆì˜¤)ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
    ///
    /// **ë©”ëª¨ë¦¬ ê³„ì‚°**:
    /// ```
    /// channels = 2 (ìŠ¤í…Œë ˆì˜¤)
    /// sampleCount = 1024
    /// bytesPerSample = 4 (float32)
    /// â†’ ì´ í¬ê¸° = 2 Ã— 1024 Ã— 4 = 8,192 bytes = 8KB
    /// ```
    let channels: Int

    /// @var format
    /// @brief ì˜¤ë””ì˜¤ ìƒ˜í”Œ í¬ë§· (ë°ì´í„° íƒ€ì…)
    ///
    /// @details
    /// PCM ìƒ˜í”Œ í•˜ë‚˜ë¥¼ ì–´ë–¤ ë°ì´í„° íƒ€ì…ìœ¼ë¡œ í‘œí˜„í•˜ëŠ”ê°€ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.
    /// í¬ë§·ì— ë”°ë¼ ìŒì§ˆ, ë©”ëª¨ë¦¬ í¬ê¸°, ì²˜ë¦¬ ì†ë„ê°€ ë‹¬ë¼ì§‘ë‹ˆë‹¤.
    ///
    /// **ì£¼ìš” í¬ë§·**:
    /// - `.floatPlanar`: 32ë¹„íŠ¸ float, planar ë°°ì¹˜ (FFmpeg ê¸°ë³¸ê°’) â­
    /// - `.floatInterleaved`: 32ë¹„íŠ¸ float, interleaved ë°°ì¹˜
    /// - `.s16Planar`: 16ë¹„íŠ¸ ì •ìˆ˜, planar ë°°ì¹˜ (ë©”ëª¨ë¦¬ ì ˆì•½)
    /// - `.s16Interleaved`: 16ë¹„íŠ¸ ì •ìˆ˜, interleaved ë°°ì¹˜ (CD í˜•ì‹)
    ///
    /// **Float vs Integer**:
    /// ```
    /// Float32 (32ë¹„íŠ¸ ë¶€ë™ì†Œìˆ˜ì ):
    /// - ë²”ìœ„: -1.0 ~ +1.0 (ì •ê·œí™”ëœ ê°’)
    /// - ì¥ì : ì²˜ë¦¬ ì¤‘ ì˜¤ë²„í”Œë¡œìš° ì—†ìŒ, ì •ë°€ë„ ë†’ìŒ
    /// - ë‹¨ì : ë©”ëª¨ë¦¬ 2ë°° (4ë°”ì´íŠ¸)
    ///
    /// Int16 (16ë¹„íŠ¸ ì •ìˆ˜):
    /// - ë²”ìœ„: -32768 ~ +32767
    /// - ì¥ì : ë©”ëª¨ë¦¬ ì ˆì•½ (2ë°”ì´íŠ¸), CD í‘œì¤€
    /// - ë‹¨ì : ì²˜ë¦¬ ì¤‘ ì˜¤ë²„í”Œë¡œìš° ê°€ëŠ¥
    /// ```
    let format: AudioFormat

    /// @var data
    /// @brief ì›ì‹œ PCM ì˜¤ë””ì˜¤ ë°ì´í„° (ë°”ì´íŠ¸ ë°°ì—´)
    ///
    /// @details
    /// ì‹¤ì œ ì˜¤ë””ì˜¤ ìƒ˜í”Œ ê°’ë“¤ì´ ë°”ì´ë„ˆë¦¬ í˜•íƒœë¡œ ì €ì¥ëœ Dataì…ë‹ˆë‹¤.
    /// ì´ ë°ì´í„°ì˜ í•´ì„ ë°©ë²•ì€ `format`, `channels`, `sampleCount`ì— ë”°ë¼ ë‹¬ë¼ì§‘ë‹ˆë‹¤.
    ///
    /// **ë°ì´í„° êµ¬ì¡° ì˜ˆì‹œ (ìŠ¤í…Œë ˆì˜¤ float planar)**:
    /// ```
    /// sampleCount = 4, channels = 2, format = .floatPlanar
    ///
    /// ë©”ëª¨ë¦¬ ë ˆì´ì•„ì›ƒ:
    /// [L0_bytes][L1_bytes][L2_bytes][L3_bytes]  â† ì™¼ìª½ ì±„ë„ (16ë°”ì´íŠ¸)
    /// [R0_bytes][R1_bytes][R2_bytes][R3_bytes]  â† ì˜¤ë¥¸ìª½ ì±„ë„ (16ë°”ì´íŠ¸)
    /// ì´ 32ë°”ì´íŠ¸
    ///
    /// Float í•´ì„:
    /// ì™¼ìª½: [-0.5, 0.3, -0.8, 0.1]
    /// ì˜¤ë¥¸ìª½: [-0.4, 0.2, -0.7, 0.0]
    /// ```
    ///
    /// **ë°ì´í„° í¬ê¸° ê³„ì‚°**:
    /// ```
    /// dataSize = sampleCount Ã— channels Ã— bytesPerSample
    ///          = 1024 Ã— 2 Ã— 4
    ///          = 8,192 bytes (8KB per frame)
    /// ```
    ///
    /// FFmpegì—ì„œ ë””ì½”ë”© ì‹œ ì´ Dataë¥¼ ì±„ì›ë‹ˆë‹¤.
    let data: Data

    /// @var sampleCount
    /// @brief ìƒ˜í”Œ ê°œìˆ˜ (ì±„ë„ë‹¹)
    ///
    /// @details
    /// ì´ í”„ë ˆì„ì´ ë‹´ê³  ìˆëŠ” ì˜¤ë””ì˜¤ ìƒ˜í”Œì˜ ê°œìˆ˜ì…ë‹ˆë‹¤.
    /// ì£¼ì˜: ì „ì²´ ìƒ˜í”Œì´ ì•„ë‹ˆë¼ **ì±„ë„ë‹¹ ìƒ˜í”Œ ê°œìˆ˜**ì…ë‹ˆë‹¤!
    ///
    /// **ì˜ˆì‹œ**:
    /// ```
    /// sampleCount = 1024
    /// channels = 2 (ìŠ¤í…Œë ˆì˜¤)
    /// â†’ ì™¼ìª½ ì±„ë„: 1024ê°œ ìƒ˜í”Œ
    /// â†’ ì˜¤ë¥¸ìª½ ì±„ë„: 1024ê°œ ìƒ˜í”Œ
    /// â†’ ì „ì²´: 2048ê°œ ìƒ˜í”Œ (í•˜ì§€ë§Œ sampleCountëŠ” 1024)
    /// ```
    ///
    /// **ì¼ë°˜ì ì¸ í”„ë ˆì„ í¬ê¸°**:
    /// - AAC: 1024 ìƒ˜í”Œ per frame
    /// - MP3: 1152 ìƒ˜í”Œ per frame
    /// - Opus: 120~960 ìƒ˜í”Œ (ê°€ë³€)
    ///
    /// **ì§€ì†ì‹œê°„ ê³„ì‚°**:
    /// ```
    /// duration = sampleCount / sampleRate
    ///          = 1024 / 48000
    ///          = 0.0213ì´ˆ = 21.3ms
    /// ```
    let sampleCount: Int

    // MARK: - Initialization

    /// @brief ì˜¤ë””ì˜¤ í”„ë ˆì„ ì´ˆê¸°í™”
    ///
    /// @details
    /// FFmpegì—ì„œ ë””ì½”ë”©í•œ PCM ë°ì´í„°ë¡œ AudioFrameì„ ìƒì„±í•©ë‹ˆë‹¤.
    /// ì¼ë°˜ì ìœ¼ë¡œ VideoDecoder ë‚´ë¶€ì—ì„œ í˜¸ì¶œë˜ë©°, ì§ì ‘ ìƒì„±í•  ì¼ì€ ë“œë­…ë‹ˆë‹¤.
    ///
    /// @param timestamp ë¹„ë””ì˜¤ íƒ€ì„ë¼ì¸ ìƒì˜ ìœ„ì¹˜ (ì´ˆ)
    /// @param sampleRate ìƒ˜í”Œë§ ì£¼íŒŒìˆ˜ (Hz)
    /// @param channels ì±„ë„ ìˆ˜ (1=ëª¨ë…¸, 2=ìŠ¤í…Œë ˆì˜¤)
    /// @param format PCM ìƒ˜í”Œ í¬ë§·
    /// @param data ì›ì‹œ PCM ë°”ì´íŠ¸ ë°ì´í„°
    /// @param sampleCount ì±„ë„ë‹¹ ìƒ˜í”Œ ê°œìˆ˜
    ///
    /// ## ìƒì„± ì˜ˆì‹œ (VideoDecoder ë‚´ë¶€)
    /// ```swift
    /// // FFmpegì—ì„œ ë””ì½”ë”©í•œ AVFrameì„ AudioFrameìœ¼ë¡œ ë³€í™˜
    /// let pcmData = Data(bytes: avFrame.data[0], count: dataSize)
    ///
    /// let audioFrame = AudioFrame(
    ///     timestamp: avFrame.pts * timeBase,
    ///     sampleRate: avFrame.sample_rate,
    ///     channels: avFrame.channels,
    ///     format: .floatPlanar,
    ///     data: pcmData,
    ///     sampleCount: avFrame.nb_samples
    /// )
    /// ```
    init(
        timestamp: TimeInterval,
        sampleRate: Int,
        channels: Int,
        format: AudioFormat,
        data: Data,
        sampleCount: Int
    ) {
        self.timestamp = timestamp
        self.sampleRate = sampleRate
        self.channels = channels
        self.format = format
        self.data = data
        self.sampleCount = sampleCount
    }

    // MARK: - Computed Properties

    /// @brief ì´ ì˜¤ë””ì˜¤ í”„ë ˆì„ì˜ ì§€ì†ì‹œê°„ (ì´ˆ)
    ///
    /// @return ì§€ì†ì‹œê°„ (TimeInterval)
    ///
    /// @details
    /// ì´ í”„ë ˆì„ì„ ì¬ìƒí•˜ëŠ” ë° ê±¸ë¦¬ëŠ” ì‹œê°„ì„ ê³„ì‚°í•©ë‹ˆë‹¤.
    ///
    /// **ê³„ì‚° ê³µì‹**:
    /// ```
    /// duration = sampleCount / sampleRate
    /// ```
    ///
    /// **ì˜ˆì‹œ ê³„ì‚°**:
    /// ```
    /// // AAC í‘œì¤€ í”„ë ˆì„
    /// sampleCount = 1024
    /// sampleRate = 48000 Hz
    /// duration = 1024 / 48000 = 0.021333...ì´ˆ = 21.33ms
    ///
    /// // MP3 í‘œì¤€ í”„ë ˆì„
    /// sampleCount = 1152
    /// sampleRate = 44100 Hz
    /// duration = 1152 / 44100 = 0.026122...ì´ˆ = 26.12ms
    /// ```
    ///
    /// **ìš©ë„**:
    /// - íƒ€ì„ìŠ¤íƒ¬í”„ ê³„ì‚°: `nextTimestamp = currentTimestamp + duration`
    /// - ë²„í¼ë§ ì‹œê°„ ê³„ì‚°: `totalBufferedTime = sum(frame.duration)`
    /// - ë™ê¸°í™” ê²€ì¦: í”„ë ˆì„ ì§€ì†ì‹œê°„ vs ì‹¤ì œ ì¬ìƒ ì‹œê°„ ë¹„êµ
    var duration: TimeInterval {
        return Double(sampleCount) / Double(sampleRate)

        // ì˜ˆì‹œ ê²°ê³¼:
        // sampleCount=1024, sampleRate=48000
        // â†’ 1024.0 / 48000.0 = 0.0213ì´ˆ = 21.3ms
    }

    /// @brief PCM ë°ì´í„°ì˜ ì´ ë°”ì´íŠ¸ í¬ê¸°
    ///
    /// @return ë°ì´í„° í¬ê¸° (ë°”ì´íŠ¸)
    ///
    /// @details
    /// `data` í”„ë¡œí¼í‹°ì— ì €ì¥ëœ ë°”ì´íŠ¸ ë°°ì—´ì˜ í¬ê¸°ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
    ///
    /// **í¬ê¸° ê³„ì‚° ì˜ˆì‹œ**:
    /// ```
    /// // ìŠ¤í…Œë ˆì˜¤ float planar
    /// sampleCount = 1024
    /// channels = 2
    /// bytesPerSample = 4 (float32)
    ///
    /// dataSize = 1024 Ã— 2 Ã— 4 = 8,192 bytes = 8KB
    ///
    /// // ì´ˆë‹¹ ë°ì´í„°ëŸ‰ (48kHz ìŠ¤í…Œë ˆì˜¤ float)
    /// sampleRate = 48000
    /// frames_per_second = 48000 / 1024 â‰ˆ 47 frames
    /// data_per_second = 8192 Ã— 47 â‰ˆ 385KB/s
    /// data_per_minute = 385KB Ã— 60 â‰ˆ 22.6MB/min
    /// ```
    ///
    /// **í¬ë§·ë³„ í¬ê¸° ë¹„êµ (1024 ìƒ˜í”Œ, ìŠ¤í…Œë ˆì˜¤ ê¸°ì¤€)**:
    /// - Float32: 1024 Ã— 2 Ã— 4 = 8,192 bytes
    /// - Int16: 1024 Ã— 2 Ã— 2 = 4,096 bytes (ì ˆë°˜!)
    var dataSize: Int {
        return data.count
    }

    /// @brief ìƒ˜í”Œ í•˜ë‚˜ë‹¹ ë°”ì´íŠ¸ í¬ê¸° (ëª¨ë“  ì±„ë„ í¬í•¨)
    ///
    /// @return ë°”ì´íŠ¸ í¬ê¸°
    ///
    /// @details
    /// í•˜ë‚˜ì˜ "ì‹œì "ì—ì„œ ëª¨ë“  ì±„ë„ì˜ ìƒ˜í”Œì„ ì €ì¥í•˜ëŠ” ë° í•„ìš”í•œ ë°”ì´íŠ¸ ìˆ˜ì…ë‹ˆë‹¤.
    ///
    /// **ê³„ì‚° ê³µì‹**:
    /// ```
    /// bytesPerSample = format.bytesPerSample Ã— channels
    /// ```
    ///
    /// **ì˜ˆì‹œ ê³„ì‚°**:
    /// ```
    /// // Float32 ìŠ¤í…Œë ˆì˜¤
    /// format.bytesPerSample = 4 bytes (float32)
    /// channels = 2
    /// â†’ bytesPerSample = 4 Ã— 2 = 8 bytes
    ///   (ì™¼ìª½ 4ë°”ì´íŠ¸ + ì˜¤ë¥¸ìª½ 4ë°”ì´íŠ¸)
    ///
    /// // Int16 ëª¨ë…¸
    /// format.bytesPerSample = 2 bytes (int16)
    /// channels = 1
    /// â†’ bytesPerSample = 2 Ã— 1 = 2 bytes
    /// ```
    ///
    /// **Interleaved í¬ë§·ì—ì„œì˜ ë©”ëª¨ë¦¬ ë ˆì´ì•„ì›ƒ**:
    /// ```
    /// bytesPerSample = 8 (Float32 Stereo)
    ///
    /// [L0: 4ë°”ì´íŠ¸][R0: 4ë°”ì´íŠ¸] â† ìƒ˜í”Œ 0 (8ë°”ì´íŠ¸)
    /// [L1: 4ë°”ì´íŠ¸][R1: 4ë°”ì´íŠ¸] â† ìƒ˜í”Œ 1 (8ë°”ì´íŠ¸)
    /// [L2: 4ë°”ì´íŠ¸][R2: 4ë°”ì´íŠ¸] â† ìƒ˜í”Œ 2 (8ë°”ì´íŠ¸)
    /// ...
    /// ```
    var bytesPerSample: Int {
        return format.bytesPerSample * channels
    }

    // MARK: - Audio Buffer Conversion

    /// @brief AVAudioPCMBufferë¡œ ë³€í™˜ (ì¬ìƒìš©)
    ///
    /// @return ë³€í™˜ëœ AVAudioPCMBuffer, ì‹¤íŒ¨ ì‹œ nil
    ///
    /// @details
    /// FFmpegì˜ PCM ë°ì´í„°ë¥¼ Appleì˜ AVAudioEngineì—ì„œ ì¬ìƒ ê°€ëŠ¥í•œ
    /// AVAudioPCMBuffer í˜•ì‹ìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
    ///
    /// **ë³€í™˜ ê³¼ì •**:
    /// ```
    /// 1. AVAudioFormat ìƒì„±
    ///    - ìƒ˜í”Œë ˆì´íŠ¸, ì±„ë„ ìˆ˜, í¬ë§· ì •ë³´ ì„¤ì •
    ///
    /// 2. AVAudioPCMBuffer í• ë‹¹
    ///    - í•„ìš”í•œ ë©”ëª¨ë¦¬ ê³µê°„ í™•ë³´
    ///
    /// 3. PCM ë°ì´í„° ë³µì‚¬
    ///    - Planar â†’ Planar: ì±„ë„ë³„ ë³µì‚¬
    ///    - Interleaved â†’ Interleaved: ì „ì²´ ë³µì‚¬
    ///
    /// 4. frameLength ì„¤ì •
    ///    - ì‹¤ì œ ì‚¬ìš©ëœ ìƒ˜í”Œ ê°œìˆ˜ í‘œì‹œ
    /// ```
    ///
    /// **Planar vs Interleaved ë³€í™˜**:
    /// ```
    /// Planar ì…ë ¥ (FFmpeg ê¸°ë³¸):
    /// data = [L0,L1,L2,L3][R0,R1,R2,R3]
    ///         â†“ ì±„ë„ë³„ë¡œ ë³µì‚¬
    /// AVAudioPCMBuffer (Planar):
    /// channelData[0] = [L0,L1,L2,L3]
    /// channelData[1] = [R0,R1,R2,R3]
    ///
    /// Interleaved ì…ë ¥:
    /// data = [L0,R0,L1,R1,L2,R2,L3,R3]
    ///         â†“ ì „ì²´ ë³µì‚¬
    /// AVAudioPCMBuffer (Interleaved):
    /// channelData[0] = [L0,R0,L1,R1,L2,R2,L3,R3]
    /// ```
    ///
    /// **ì‹¤ì œ ì‚¬ìš© ì˜ˆì‹œ**:
    /// ```swift
    /// // AudioPlayerì—ì„œ ì¬ìƒ
    /// func playFrame(_ frame: AudioFrame) {
    ///     guard let buffer = frame.toAudioBuffer() else {
    ///         print("ë²„í¼ ë³€í™˜ ì‹¤íŒ¨")
    ///         return
    ///     }
    ///
    ///     // AVAudioPlayerNodeì— ìŠ¤ì¼€ì¤„ë§
    ///     playerNode.scheduleBuffer(buffer) {
    ///         print("ì¬ìƒ ì™„ë£Œ")
    ///     }
    /// }
    /// ```
    ///
    /// **ì‹¤íŒ¨ ì¼€ì´ìŠ¤**:
    /// - ì§€ì›í•˜ì§€ ì•ŠëŠ” ì˜¤ë””ì˜¤ í¬ë§·
    /// - ì˜ëª»ëœ ìƒ˜í”Œë ˆì´íŠ¸ ë˜ëŠ” ì±„ë„ ìˆ˜
    /// - ë©”ëª¨ë¦¬ ë¶€ì¡±
    func toAudioBuffer() -> AVAudioPCMBuffer? {
        // 1ë‹¨ê³„: AVAudioFormat ìƒì„±
        // Appleì˜ ì˜¤ë””ì˜¤ ì‹œìŠ¤í…œì´ ì´í•´í•  ìˆ˜ ìˆëŠ” í¬ë§· ê°ì²´ ìƒì„±
        guard let audioFormat = AVAudioFormat(
            commonFormat: format.commonFormat,      // ìƒ˜í”Œ íƒ€ì… (.pcmFormatFloat32 ë“±)
            sampleRate: Double(sampleRate),         // 48000.0 Hz
            channels: AVAudioChannelCount(channels), // 2 (ìŠ¤í…Œë ˆì˜¤)
            interleaved: format.isInterleaved       // false (planar)
        ) else {
            // í¬ë§· ìƒì„± ì‹¤íŒ¨ = ì§€ì›í•˜ì§€ ì•ŠëŠ” ì¡°í•©
            return nil
        }

        // 2ë‹¨ê³„: AVAudioPCMBuffer í• ë‹¹
        // ì‹¤ì œ PCM ë°ì´í„°ë¥¼ ë‹´ì„ ë©”ëª¨ë¦¬ ë²„í¼ ìƒì„±
        guard let buffer = AVAudioPCMBuffer(
            pcmFormat: audioFormat,                        // ìœ„ì—ì„œ ìƒì„±í•œ í¬ë§·
            frameCapacity: AVAudioFrameCount(sampleCount) // ìµœëŒ€ 1024ê°œ ìƒ˜í”Œ
        ) else {
            // ë²„í¼ í• ë‹¹ ì‹¤íŒ¨ = ë©”ëª¨ë¦¬ ë¶€ì¡±
            return nil
        }

        // ì‹¤ì œ ì‚¬ìš©í•  í”„ë ˆì„ ê°œìˆ˜ ì„¤ì • (ì¤‘ìš”!)
        // frameCapacityëŠ” "ìµœëŒ€ ìš©ëŸ‰", frameLengthëŠ” "ì‹¤ì œ ì‚¬ìš©ëŸ‰"
        buffer.frameLength = AVAudioFrameCount(sampleCount)

        // ì˜ˆì‹œ:
        // frameCapacity = 1024 (í• ë‹¹ëœ ê³µê°„)
        // frameLength = 512 (ì‹¤ì œ ì‚¬ìš©ëœ ê³µê°„)
        // â†’ 512ê°œë§Œ ì¬ìƒë¨

        // 3ë‹¨ê³„: PCM ë°ì´í„° ë³µì‚¬
        // self.data (Data) â†’ buffer.floatChannelData (UnsafeMutablePointer)

        if format.isInterleaved {
            // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            // Interleaved í¬ë§·: LRLRLR... í˜•ì‹
            // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            //
            // ë°ì´í„° ë ˆì´ì•„ì›ƒ (ìŠ¤í…Œë ˆì˜¤):
            // [L0, R0, L1, R1, L2, R2, ...]
            //
            // AVAudioPCMBuffer (Interleaved):
            // channelData[0] = ëª¨ë“  ë°ì´í„° (Lê³¼ R ì„ì—¬ìˆìŒ)
            //
            // ë³µì‚¬ ë°©ë²•: ì „ì²´ë¥¼ í•œ ë²ˆì— memcpy
            //
            if let channelData = buffer.floatChannelData {
                // Dataë¥¼ unsafe bytesë¡œ ì ‘ê·¼
                data.withUnsafeBytes { dataBytes in
                    // baseAddress = Dataì˜ ì‹œì‘ í¬ì¸í„°
                    if let sourcePtr = dataBytes.baseAddress {
                        // ì „ì²´ ë°ì´í„°ë¥¼ channelData[0]ìœ¼ë¡œ ë³µì‚¬
                        memcpy(
                            channelData[0],   // ëª©ì ì§€: bufferì˜ ì²« ë²ˆì§¸ ì±„ë„
                            sourcePtr,        // ì†ŒìŠ¤: self.dataì˜ ì‹œì‘
                            data.count        // í¬ê¸°: ì „ì²´ ë°”ì´íŠ¸
                        )

                        // ì˜ˆì‹œ: 8ë°”ì´íŠ¸ ë³µì‚¬ (Float32 ìŠ¤í…Œë ˆì˜¤, 1ìƒ˜í”Œ)
                        // sourcePtr:      [L0:4byte][R0:4byte]
                        //                    â†“ memcpy
                        // channelData[0]: [L0:4byte][R0:4byte]
                    }
                }
            }

        } else {
            // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            // Planar í¬ë§·: LLL...RRR... í˜•ì‹ (FFmpeg ê¸°ë³¸)
            // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            //
            // ë°ì´í„° ë ˆì´ì•„ì›ƒ (ìŠ¤í…Œë ˆì˜¤):
            // [L0, L1, L2, ...] [R0, R1, R2, ...]
            //  ì™¼ìª½ ì±„ë„ ì „ì²´    ì˜¤ë¥¸ìª½ ì±„ë„ ì „ì²´
            //
            // AVAudioPCMBuffer (Planar):
            // channelData[0] = [L0, L1, L2, ...]
            // channelData[1] = [R0, R1, R2, ...]
            //
            // ë³µì‚¬ ë°©ë²•: ì±„ë„ë³„ë¡œ ë‚˜ëˆ ì„œ memcpy
            //
            if let channelData = buffer.floatChannelData {
                // ì±„ë„ í•˜ë‚˜ë‹¹ ë°”ì´íŠ¸ í¬ê¸° ê³„ì‚°
                let bytesPerChannel = sampleCount * format.bytesPerSample
                // ì˜ˆ: 1024 ìƒ˜í”Œ Ã— 4ë°”ì´íŠ¸(float32) = 4096ë°”ì´íŠ¸

                data.withUnsafeBytes { dataBytes in
                    if let sourcePtr = dataBytes.baseAddress {
                        // ê° ì±„ë„ì„ ìˆœíšŒí•˜ë©° ë³µì‚¬
                        for channel in 0..<channels {
                            // ì´ ì±„ë„ì˜ ë°ì´í„° ì‹œì‘ ìœ„ì¹˜ ê³„ì‚°
                            let offset = channel * bytesPerChannel

                            // ì˜ˆì‹œ (ìŠ¤í…Œë ˆì˜¤):
                            // channel 0 (ì™¼ìª½): offset = 0 Ã— 4096 = 0
                            // channel 1 (ì˜¤ë¥¸ìª½): offset = 1 Ã— 4096 = 4096
                            //
                            // ë©”ëª¨ë¦¬ ë§µ:
                            // sourcePtr + 0    : [L0,L1,L2,L3,...] (4096ë°”ì´íŠ¸)
                            // sourcePtr + 4096 : [R0,R1,R2,R3,...] (4096ë°”ì´íŠ¸)

                            // ì´ ì±„ë„ì˜ ë°ì´í„°ë¥¼ ë²„í¼ë¡œ ë³µì‚¬
                            memcpy(
                                channelData[channel],  // ëª©ì ì§€: ì±„ë„ë³„ ë²„í¼
                                sourcePtr + offset,    // ì†ŒìŠ¤: ì±„ë„ ì‹œì‘ ìœ„ì¹˜
                                bytesPerChannel        // í¬ê¸°: 4096ë°”ì´íŠ¸
                            )

                            // ê²°ê³¼:
                            // channelData[0] â† [L0,L1,L2,L3,...]
                            // channelData[1] â† [R0,R1,R2,R3,...]
                        }
                    }
                }
            }
        }

        // 4ë‹¨ê³„: ë³€í™˜ ì™„ë£Œëœ ë²„í¼ ë°˜í™˜
        // ì´ì œ AVAudioPlayerNode.scheduleBuffer()ë¡œ ì¬ìƒ ê°€ëŠ¥
        return buffer
    }
}

// MARK: - Supporting Types

/// @enum AudioFormat
/// @brief ì˜¤ë””ì˜¤ ìƒ˜í”Œ í¬ë§· ì •ì˜
///
/// @details
/// PCM(Pulse Code Modulation) ìƒ˜í”Œì„ ë©”ëª¨ë¦¬ì— ì €ì¥í•˜ëŠ” ë°©ì‹ì„ ì •ì˜í•©ë‹ˆë‹¤.
/// í¬ë§· ì„ íƒì€ ìŒì§ˆ, ë©”ëª¨ë¦¬ í¬ê¸°, ì²˜ë¦¬ ì†ë„ì— ì˜í–¥ì„ ì¤ë‹ˆë‹¤.
///
/// ## í¬ë§· ì„ íƒ ê°€ì´ë“œ
///
/// **Float (ë¶€ë™ì†Œìˆ˜ì ) vs Integer (ì •ìˆ˜)**:
/// ```
/// Float í˜•ì‹ (ê¶Œì¥):
/// âœ… ì²˜ë¦¬ ì¤‘ ì˜¤ë²„í”Œë¡œìš° ì—†ìŒ (-1.0 ~ +1.0 ì •ê·œí™”)
/// âœ… ì •ë°€ë„ ë†’ìŒ (32ë¹„íŠ¸ = ì•½ 150dB ë‹¤ì´ë‚´ë¯¹ ë ˆì¸ì§€)
/// âœ… DSP ì—°ì‚° ê°„í¸ (ì¦í­, ë¯¹ì‹± ë“±)
/// âŒ ë©”ëª¨ë¦¬ 2ë°° (4ë°”ì´íŠ¸)
/// âŒ ë””ìŠ¤í¬ ì €ì¥ ì‹œ ë¹„íš¨ìœ¨
///
/// Integer í˜•ì‹:
/// âœ… ë©”ëª¨ë¦¬ ì ˆì•½ (2ë°”ì´íŠ¸)
/// âœ… CD í‘œì¤€ (Int16)
/// âœ… ë””ìŠ¤í¬ ì €ì¥ íš¨ìœ¨
/// âŒ ì²˜ë¦¬ ì¤‘ ì˜¤ë²„í”Œë¡œìš° ì£¼ì˜
/// âŒ ì •ë°€ë„ ì œí•œ (16ë¹„íŠ¸ = 96dB)
/// ```
///
/// **Planar vs Interleaved**:
/// ```
/// Planar (ì±„ë„ ë¶„ë¦¬):
/// âœ… ì±„ë„ë³„ ì²˜ë¦¬ ì‰¬ì›€ (ë³¼ë¥¨, ì´í™íŠ¸)
/// âœ… FFmpeg ê¸°ë³¸ ì¶œë ¥
/// âŒ ìºì‹œ íš¨ìœ¨ ë‚®ìŒ
/// âŒ ë©”ëª¨ë¦¬ ë¶„ì‚°
///
/// Interleaved (ì±„ë„ êµì°¨):
/// âœ… ë©”ëª¨ë¦¬ ì—°ì†ì„±
/// âœ… ìºì‹œ íš¨ìœ¨ ë†’ìŒ
/// âœ… CD/íŒŒì¼ ì €ì¥ í‘œì¤€
/// âŒ ì±„ë„ë³„ ì²˜ë¦¬ ì‹œ stride í•„ìš”
/// ```
///
/// ## í¬ë§·ë³„ ë©”ëª¨ë¦¬ í¬ê¸° ë¹„êµ
/// (1024 ìƒ˜í”Œ, ìŠ¤í…Œë ˆì˜¤, 48kHz ê¸°ì¤€)
///
/// | í¬ë§· | 1í”„ë ˆì„ | 1ì´ˆ | 1ë¶„ |
/// |------|---------|-----|-----|
/// | Float32 | 8KB | 375KB | 22MB |
/// | Int16 | 4KB | 188KB | 11MB |
///
/// ## ì‚¬ìš© ì˜ˆì‹œ
/// ```swift
/// // FFmpeg ë””ì½”ë”© ê²°ê³¼ (ì¼ë°˜ì ìœ¼ë¡œ Planar)
/// let format: AudioFormat = .floatPlanar
///
/// // AVAudioEngine ì¬ìƒ ì‹œ ìë™ ë³€í™˜
/// if format.isInterleaved {
///     // ê·¸ëŒ€ë¡œ ì‚¬ìš©
/// } else {
///     // Planar â†’ Interleaved ë³€í™˜ (toAudioBuffer ë‚´ë¶€)
/// }
/// ```
enum AudioFormat: String, Codable {
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Float í˜•ì‹ (32ë¹„íŠ¸ ë¶€ë™ì†Œìˆ˜ì )
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    /// @brief 32ë¹„íŠ¸ Float (Planar ë°°ì¹˜)
    ///
    /// @details
    /// FFmpegì˜ ê¸°ë³¸ ì˜¤ë””ì˜¤ ì¶œë ¥ í˜•ì‹ì…ë‹ˆë‹¤.
    /// ê° ì±„ë„ì˜ ìƒ˜í”Œì´ ë©”ëª¨ë¦¬ì—ì„œ ë¶„ë¦¬ë˜ì–´ ì—°ì†ìœ¼ë¡œ ë°°ì¹˜ë©ë‹ˆë‹¤.
    ///
    /// **ë©”ëª¨ë¦¬ ë ˆì´ì•„ì›ƒ (ìŠ¤í…Œë ˆì˜¤, 4ìƒ˜í”Œ)**:
    /// ```
    /// Offset 0~15:  [L0][L1][L2][L3]  â† ì™¼ìª½ ì±„ë„ (16ë°”ì´íŠ¸)
    /// Offset 16~31: [R0][R1][R2][R3]  â† ì˜¤ë¥¸ìª½ ì±„ë„ (16ë°”ì´íŠ¸)
    /// ```
    ///
    /// **ìƒ˜í”Œ ê°’ ë²”ìœ„**: -1.0 ~ +1.0
    /// - -1.0 = ìµœëŒ€ ìŒì•• (ìŒ)
    /// -  0.0 = ë¬´ìŒ
    /// - +1.0 = ìµœëŒ€ ìŒì•• (ì–‘)
    ///
    /// **íŠ¹ì§•**:
    /// - FFmpeg: `AV_SAMPLE_FMT_FLTP`
    /// - CoreAudio: `kAudioFormatFlagIsFloat | kAudioFormatFlagIsNonInterleaved`
    /// - í¬ê¸°: 4ë°”ì´íŠ¸ Ã— ìƒ˜í”Œ ìˆ˜ Ã— ì±„ë„ ìˆ˜
    case floatPlanar = "fltp"

    /// @brief 32ë¹„íŠ¸ Float (Interleaved ë°°ì¹˜)
    ///
    /// @details
    /// ìŠ¤í…Œë ˆì˜¤ì˜ ê²½ìš° ì¢Œìš° ìƒ˜í”Œì´ ë²ˆê°ˆì•„ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.
    /// ì¼ë¶€ ì˜¤ë””ì˜¤ ì²˜ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì„ í˜¸í•˜ëŠ” í˜•ì‹ì…ë‹ˆë‹¤.
    ///
    /// **ë©”ëª¨ë¦¬ ë ˆì´ì•„ì›ƒ (ìŠ¤í…Œë ˆì˜¤, 4ìƒ˜í”Œ)**:
    /// ```
    /// [L0][R0][L1][R1][L2][R2][L3][R3]
    ///  â†‘   â†‘   â†‘   â†‘   ...
    ///  ì¢Œ  ìš°  ì¢Œ  ìš°
    /// ```
    ///
    /// **íŠ¹ì§•**:
    /// - FFmpeg: `AV_SAMPLE_FMT_FLT`
    /// - CoreAudio: `kAudioFormatFlagIsFloat | kAudioFormatFlagIsPacked`
    /// - í¬ê¸°: 4ë°”ì´íŠ¸ Ã— ìƒ˜í”Œ ìˆ˜ Ã— ì±„ë„ ìˆ˜
    case floatInterleaved = "flt"

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // Integer í˜•ì‹ (16ë¹„íŠ¸/32ë¹„íŠ¸ ì •ìˆ˜)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    /// @brief 16ë¹„íŠ¸ Signed Integer (Planar ë°°ì¹˜)
    ///
    /// @details
    /// ë©”ëª¨ë¦¬ë¥¼ ì ˆì•½í•˜ë©´ì„œë„ CD í’ˆì§ˆì„ ì œê³µí•©ë‹ˆë‹¤.
    /// ì±„ë„ë³„ë¡œ ë¶„ë¦¬ë˜ì–´ ì €ì¥ë©ë‹ˆë‹¤.
    ///
    /// **ë©”ëª¨ë¦¬ ë ˆì´ì•„ì›ƒ (ìŠ¤í…Œë ˆì˜¤, 4ìƒ˜í”Œ)**:
    /// ```
    /// Offset 0~7:  [L0][L1][L2][L3]  â† ì™¼ìª½ ì±„ë„ (8ë°”ì´íŠ¸)
    /// Offset 8~15: [R0][R1][R2][R3]  â† ì˜¤ë¥¸ìª½ ì±„ë„ (8ë°”ì´íŠ¸)
    /// ```
    ///
    /// **ìƒ˜í”Œ ê°’ ë²”ìœ„**: -32768 ~ +32767
    /// - -32768 = ìµœëŒ€ ìŒì•• (ìŒ)
    /// -      0 = ë¬´ìŒ
    /// - +32767 = ìµœëŒ€ ìŒì•• (ì–‘)
    ///
    /// **Float ë³€í™˜**:
    /// ```
    /// intValue â†’ floatValue:
    /// floatValue = intValue / 32768.0
    ///
    /// ì˜ˆ:
    /// 32767 â†’ 32767 / 32768.0 = +0.999969... â‰ˆ +1.0
    /// -16384 â†’ -16384 / 32768.0 = -0.5
    /// 0 â†’ 0 / 32768.0 = 0.0
    /// ```
    ///
    /// **íŠ¹ì§•**:
    /// - FFmpeg: `AV_SAMPLE_FMT_S16P`
    /// - CD í‘œì¤€ (CD-DA)
    /// - í¬ê¸°: Floatì˜ ì ˆë°˜ (2ë°”ì´íŠ¸ Ã— ìƒ˜í”Œ ìˆ˜ Ã— ì±„ë„ ìˆ˜)
    case s16Planar = "s16p"

    /// @brief 16ë¹„íŠ¸ Signed Integer (Interleaved ë°°ì¹˜)
    ///
    /// @details
    /// CD ì˜¤ë””ì˜¤ í‘œì¤€ í˜•ì‹ì…ë‹ˆë‹¤.
    /// WAV íŒŒì¼ì˜ ê¸°ë³¸ í¬ë§·ì´ê¸°ë„ í•©ë‹ˆë‹¤.
    ///
    /// **ë©”ëª¨ë¦¬ ë ˆì´ì•„ì›ƒ (ìŠ¤í…Œë ˆì˜¤, 4ìƒ˜í”Œ)**:
    /// ```
    /// [L0][R0][L1][R1][L2][R2][L3][R3]
    /// ê° ìƒ˜í”Œ 2ë°”ì´íŠ¸, ì´ 16ë°”ì´íŠ¸
    /// ```
    ///
    /// **íŠ¹ì§•**:
    /// - FFmpeg: `AV_SAMPLE_FMT_S16`
    /// - CD í‘œì¤€, WAV í‘œì¤€
    /// - í¬ê¸°: 2ë°”ì´íŠ¸ Ã— ìƒ˜í”Œ ìˆ˜ Ã— ì±„ë„ ìˆ˜
    case s16Interleaved = "s16"

    /// @brief 32ë¹„íŠ¸ Signed Integer (Planar ë°°ì¹˜)
    ///
    /// @details
    /// ê³ ìŒì§ˆì´ í•„ìš”í•˜ì§€ë§Œ ë¶€ë™ì†Œìˆ˜ì  ì—°ì‚°ì„ í”¼í•˜ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.
    /// DVD-Audio, ì¼ë¶€ ê³ ê¸‰ ì˜¤ë””ì˜¤ ì¥ë¹„ì—ì„œ ì‚¬ìš©ë©ë‹ˆë‹¤.
    ///
    /// **ìƒ˜í”Œ ê°’ ë²”ìœ„**: -2,147,483,648 ~ +2,147,483,647
    ///
    /// **íŠ¹ì§•**:
    /// - FFmpeg: `AV_SAMPLE_FMT_S32P`
    /// - í¬ê¸°: 4ë°”ì´íŠ¸ Ã— ìƒ˜í”Œ ìˆ˜ Ã— ì±„ë„ ìˆ˜ (Floatì™€ ë™ì¼)
    case s32Planar = "s32p"

    /// @brief 32ë¹„íŠ¸ Signed Integer (Interleaved ë°°ì¹˜)
    ///
    /// @details
    /// **íŠ¹ì§•**:
    /// - FFmpeg: `AV_SAMPLE_FMT_S32`
    /// - í¬ê¸°: 4ë°”ì´íŠ¸ Ã— ìƒ˜í”Œ ìˆ˜ Ã— ì±„ë„ ìˆ˜
    case s32Interleaved = "s32"

    /// @brief ìƒ˜í”Œ í•˜ë‚˜ë‹¹ ë°”ì´íŠ¸ í¬ê¸°
    ///
    /// @return ë°”ì´íŠ¸ í¬ê¸°
    ///
    /// @details
    /// ì±„ë„ ìˆ˜ë¥¼ ì œì™¸í•œ, ìˆœìˆ˜í•˜ê²Œ í•˜ë‚˜ì˜ ìƒ˜í”Œ ê°’ì„ ì €ì¥í•˜ëŠ” ë° í•„ìš”í•œ ë°”ì´íŠ¸ ìˆ˜ì…ë‹ˆë‹¤.
    ///
    /// **ë°˜í™˜ê°’**:
    /// ```
    /// Float32 / Int32: 4ë°”ì´íŠ¸
    /// Int16:           2ë°”ì´íŠ¸
    /// ```
    var bytesPerSample: Int {
        switch self {
        case .floatPlanar, .floatInterleaved, .s32Planar, .s32Interleaved:
            return 4  // 32ë¹„íŠ¸ = 4ë°”ì´íŠ¸
        case .s16Planar, .s16Interleaved:
            return 2  // 16ë¹„íŠ¸ = 2ë°”ì´íŠ¸
        }
    }

    /// @brief Interleaved í˜•ì‹ì¸ê°€?
    ///
    /// @return Interleavedì´ë©´ true, Planarì´ë©´ false
    ///
    /// @details
    /// ì±„ë„ë“¤ì´ êµì°¨(Interleaved)ë˜ì–´ ìˆëŠ”ì§€, ë¶„ë¦¬(Planar)ë˜ì–´ ìˆëŠ”ì§€ ë°˜í™˜í•©ë‹ˆë‹¤.
    ///
    /// **ë°˜í™˜ê°’**:
    /// ```
    /// Interleaved í¬ë§·: true  (flt, s16, s32)
    /// Planar í¬ë§·:      false (fltp, s16p, s32p)
    /// ```
    var isInterleaved: Bool {
        switch self {
        case .floatInterleaved, .s16Interleaved, .s32Interleaved:
            return true  // êµì°¨ ë°°ì¹˜
        case .floatPlanar, .s16Planar, .s32Planar:
            return false // í‰ë©´ ë°°ì¹˜
        }
    }

    /// @brief AVAudioCommonFormatìœ¼ë¡œ ë³€í™˜
    ///
    /// @return AVAudioCommonFormat
    ///
    /// @details
    /// Appleì˜ AVFoundationì—ì„œ ì‚¬ìš©í•˜ëŠ” í‘œì¤€ í¬ë§· enumìœ¼ë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
    /// toAudioBuffer() ë©”ì„œë“œì—ì„œ AVAudioFormat ìƒì„± ì‹œ ì‚¬ìš©ë©ë‹ˆë‹¤.
    ///
    /// **ë§¤í•‘**:
    /// ```
    /// Float (32ë¹„íŠ¸) â†’ .pcmFormatFloat32
    /// Int16 (16ë¹„íŠ¸) â†’ .pcmFormatInt16
    /// Int32 (32ë¹„íŠ¸) â†’ .pcmFormatInt32
    /// ```
    var commonFormat: AVAudioCommonFormat {
        switch self {
        case .floatPlanar, .floatInterleaved:
            return .pcmFormatFloat32
        case .s16Planar, .s16Interleaved:
            return .pcmFormatInt16
        case .s32Planar, .s32Interleaved:
            return .pcmFormatInt32
        }
    }
}

// MARK: - Equatable

/// @brief AudioFrame ë™ë“±ì„± ë¹„êµ
///
/// @details
/// ë‘ AudioFrameì´ "ê°™ì€" í”„ë ˆì„ì¸ì§€ íŒë‹¨í•©ë‹ˆë‹¤.
/// ì£¼ë¡œ ë””ë²„ê¹…, í…ŒìŠ¤íŠ¸, ì¤‘ë³µ ì œê±° ë“±ì— ì‚¬ìš©ë©ë‹ˆë‹¤.
///
/// **ë¹„êµ ê¸°ì¤€**:
/// - timestamp: ê°™ì€ ì‹œì ì¸ê°€?
/// - sampleCount: ê°™ì€ ê°œìˆ˜ì˜ ìƒ˜í”Œì¸ê°€?
/// - sampleRate: ê°™ì€ ìƒ˜í”Œë ˆì´íŠ¸ì¸ê°€?
/// - channels: ê°™ì€ ì±„ë„ ìˆ˜ì¸ê°€?
///
/// **ì£¼ì˜**: `data`ëŠ” ë¹„êµí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤!
/// ì‹¤ì œ PCM ë°”ì´íŠ¸ ë°ì´í„°ê°€ ë‹¬ë¼ë„, ë©”íƒ€ì •ë³´ê°€ ê°™ìœ¼ë©´ "ê°™ì€ í”„ë ˆì„"ìœ¼ë¡œ ê°„ì£¼í•©ë‹ˆë‹¤.
/// ì´ëŠ” ì„±ëŠ¥ìƒì˜ ì´ìœ ì…ë‹ˆë‹¤. (dataëŠ” ìˆ˜ì²œ ë°”ì´íŠ¸ì¼ ìˆ˜ ìˆìŒ)
///
/// ## ì‚¬ìš© ì˜ˆì‹œ
/// ```swift
/// let frame1 = AudioFrame(timestamp: 1.0, ...)
/// let frame2 = AudioFrame(timestamp: 1.0, ...)
/// let frame3 = AudioFrame(timestamp: 2.0, ...)
///
/// frame1 == frame2  // true (ê°™ì€ íƒ€ì„ìŠ¤íƒ¬í”„)
/// frame1 == frame3  // false (ë‹¤ë¥¸ íƒ€ì„ìŠ¤íƒ¬í”„)
///
/// // ì¤‘ë³µ í”„ë ˆì„ ì œê±°
/// let frames = [frame1, frame2, frame3]
/// let uniqueFrames = Array(Set(frames))  // [frame1, frame3]
/// ```
extension AudioFrame: Equatable {
    /// @brief ë‘ AudioFrame ë¹„êµ
    /// @param lhs ì™¼ìª½ í”¼ì—°ì‚°ì
    /// @param rhs ì˜¤ë¥¸ìª½ í”¼ì—°ì‚°ì
    /// @return ë™ë“±í•˜ë©´ true
    static func == (lhs: AudioFrame, rhs: AudioFrame) -> Bool {
        return lhs.timestamp == rhs.timestamp &&
            lhs.sampleCount == rhs.sampleCount &&
            lhs.sampleRate == rhs.sampleRate &&
            lhs.channels == rhs.channels

        // dataëŠ” ë¹„êµí•˜ì§€ ì•ŠìŒ (ì„±ëŠ¥ìƒ ì´ìœ )
        // í•„ìš”ì‹œ data ë¹„êµ ì¶”ê°€ ê°€ëŠ¥:
        // && lhs.data == rhs.data
    }
}

// MARK: - CustomStringConvertible

/// @brief AudioFrame ë””ë²„ê·¸ ë¬¸ìì—´ í‘œí˜„
///
/// @details
/// print() ë˜ëŠ” ë””ë²„ê±°ì—ì„œ AudioFrameì„ ì¶œë ¥í•  ë•Œ ë³´ê¸° ì¢‹ì€ í˜•íƒœë¡œ ë³€í™˜í•©ë‹ˆë‹¤.
///
/// **ì¶œë ¥ ì˜ˆì‹œ**:
/// ```
/// Audio @ 1.500s (48000 Hz, stereo, fltp format) 1024 samples, 8192 bytes
///
/// í•´ì„:
/// - íƒ€ì„ìŠ¤íƒ¬í”„: 1.500ì´ˆ
/// - ìƒ˜í”Œë ˆì´íŠ¸: 48000 Hz
/// - ì±„ë„: stereo (2ì±„ë„)
/// - í¬ë§·: fltp (Float32 Planar)
/// - ìƒ˜í”Œ ê°œìˆ˜: 1024ê°œ
/// - ë°ì´í„° í¬ê¸°: 8192ë°”ì´íŠ¸ (8KB)
/// ```
///
/// **ì±„ë„ í‘œì‹œ**:
/// ```
/// channels = 1 â†’ "mono"
/// channels = 2 â†’ "stereo"
/// channels = 6 â†’ "6ch" (5.1 ì„œë¼ìš´ë“œ)
/// ```
///
/// ## ì‚¬ìš© ì˜ˆì‹œ
/// ```swift
/// let frame = AudioFrame(...)
///
/// // ì§ì ‘ ì¶œë ¥
/// print(frame)
/// // ì¶œë ¥: Audio @ 1.500s (48000 Hz, stereo, fltp format) 1024 samples, 8192 bytes
///
/// // ë¡œê·¸ì— í¬í•¨
/// print("ì¬ìƒ ì¤‘: \(frame)")
/// // ì¶œë ¥: ì¬ìƒ ì¤‘: Audio @ 1.500s (48000 Hz, stereo, fltp format) 1024 samples, 8192 bytes
/// ```
extension AudioFrame: CustomStringConvertible {
    /// @brief ë””ë²„ê·¸ ë¬¸ìì—´
    var description: String {
        // ì±„ë„ ìˆ˜ë¥¼ ì‚¬ëŒì´ ì½ê¸° ì¢‹ì€ ë¬¸ìì—´ë¡œ ë³€í™˜
        let channelStr: String
        if channels == 1 {
            channelStr = "mono"      // ëª¨ë…¸
        } else if channels == 2 {
            channelStr = "stereo"    // ìŠ¤í…Œë ˆì˜¤
        } else {
            channelStr = "\(channels)ch"  // "6ch", "8ch" ë“±
        }

        // í¬ë§·ëœ ë¬¸ìì—´ ìƒì„±
        return String(
            format: "Audio @ %.3fs (%d Hz, %@, %@ format) %d samples, %d bytes",
            timestamp,              // íƒ€ì„ìŠ¤íƒ¬í”„ (ì†Œìˆ˜ì  3ìë¦¬)
            sampleRate,            // ìƒ˜í”Œë ˆì´íŠ¸
            channelStr,            // ì±„ë„ ë¬¸ìì—´
            format.rawValue,       // í¬ë§· ("fltp", "s16" ë“±)
            sampleCount,           // ìƒ˜í”Œ ê°œìˆ˜
            dataSize               // ë°”ì´íŠ¸ í¬ê¸°
        )

        // ì˜ˆì‹œ ê²°ê³¼:
        // "Audio @ 1.500s (48000 Hz, stereo, fltp format) 1024 samples, 8192 bytes"
    }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// í†µí•© ê°€ì´ë“œ: AudioFrame ì‚¬ìš© í”Œë¡œìš°
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//
// 1ï¸âƒ£ ë””ì½”ë”© (VideoDecoder)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// MP3/AAC íŒŒì¼ â†’ FFmpeg ë””ì½”ë”© â†’ PCM ë°ì´í„°
//
// let audioFrame = AudioFrame(
//     timestamp: pts,
//     sampleRate: 48000,
//     channels: 2,
//     format: .floatPlanar,
//     data: pcmData,
//     sampleCount: 1024
// )
//
// 2ï¸âƒ£ íì‰ (VideoChannel)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ë””ì½”ë”©ëœ í”„ë ˆì„ì„ ë²„í¼ì— ì €ì¥
//
// audioBuffer.append(audioFrame)
//
// 3ï¸âƒ£ ë™ê¸°í™” (SyncController)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ë¹„ë””ì˜¤ í”„ë ˆì„ê³¼ íƒ€ì„ìŠ¤íƒ¬í”„ ë¹„êµ
//
// if abs(videoFrame.timestamp - audioFrame.timestamp) < 0.05 {
//     // ë™ê¸°í™” OK (Â±50ms ì´ë‚´)
// }
//
// 4ï¸âƒ£ ì¬ìƒ (AudioPlayer)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// AVAudioPCMBufferë¡œ ë³€í™˜ í›„ ì¬ìƒ
//
// if let buffer = audioFrame.toAudioBuffer() {
//     playerNode.scheduleBuffer(buffer)
// }
//
// 5ï¸âƒ£ ìŠ¤í”¼ì»¤ ì¶œë ¥
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// AVAudioEngine â†’ ì‹œìŠ¤í…œ ì˜¤ë””ì˜¤ â†’ ğŸ”Š
//
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
