# macOS용 블랙박스 플레이어

> 🌐 **Language**: [English](README.md) | [한국어](#)

> 다채널 동기화, GPS 매핑 및 포괄적인 영상 관리 기능을 갖춘 블랙박스 SD 카드 영상 재생용 네이티브 macOS 애플리케이션

## 📋 목차

- [개요](#개요)
- [주요 기능](#주요-기능)
- [기술 하이라이트](#기술-하이라이트)
- [문서](#문서)
- [기술 스택](#기술-스택)
- [시스템 요구사항](#시스템-요구사항)
- [프로젝트 타임라인](#프로젝트-타임라인)
- [시작하기](#시작하기)
- [프로젝트 구조](#프로젝트-구조)
- [개발 단계](#개발-단계)
- [기여하기](#기여하기)
- [라이선스](#라이선스)

---

## 개요

macOS용 블랙박스 플레이어는 현재 Windows에서만 사용 가능한 블랙박스 뷰어 경험을 macOS 사용자에게 제공하도록 설계된 네이티브 애플리케이션입니다. 이 전문가급 뷰어는 프레임 단위로 완벽하게 동기화된 최대 5개 영상 채널의 동시 재생, GPS 경로 시각화, G-센서 데이터 분석 및 포괄적인 파일 관리를 지원합니다.

### 배경

최신 블랙박스는 여러 카메라(전방, 후방, 좌, 우, 실내)에서 동시에 영상을 녹화하고 SD 카드에 영상을 저장합니다. 이 프로젝트는 Mac에서 블랙박스 영상을 보고 관리할 수 있는 완전한 기능을 갖춘 네이티브 macOS 애플리케이션을 제공합니다.

### 프로젝트 목표

1. **Windows 뷰어와 동등한 기능**: Windows 버전에서 사용 가능한 모든 기능 제공
2. **네이티브 macOS 경험**: 최적의 성능과 사용자 경험을 위해 Apple 프레임워크 활용
3. **전문가급 품질**: 세련되고 프로덕션 준비가 완료된 애플리케이션 제공
4. **확장성**: 향후 개선 사항(다국어, 클라우드 동기화, iOS 컴패니언)을 염두에 둔 설계

---

## 주요 기능

### 🎬 다채널 영상 재생
- 최대 **5개 채널** 동시 재생
- 프레임 단위 완벽 동기화(±50ms 정확도)
- 독립적인 채널 제어
- 다양한 레이아웃 옵션(그리드, 포커스+소형, 수평)

### 🎮 고급 재생 제어
- 재생, 일시정지, 정지, 이전/다음 파일
- 정밀한 탐색이 가능한 타임라인 스크러빙
- 가변 재생 속도(0.5x, 1x, 2x)
- 채널별 볼륨 제어
- 전체 화면 모드 지원

### 📹 영상 처리
- **MP4 내보내기**: 다채널 H.264+MP3를 표준 MP4 포맷으로 변환
- **영상 복구**: 손상된 영상 파일 복구
- **채널 추출**: 다채널 녹화본에서 특정 채널 추출
- **일괄 작업**: 여러 파일 동시 처리

### 🗺️ GPS 통합
- 지도에 실시간 GPS 경로 표시(MapKit 또는 Google Maps)
- 재생 중 동기화된 위치 업데이트
- 속도, 고도 및 방향 정보
- 재생 제어가 포함된 경로 재생

### 📊 G-센서 시각화
- 실시간 가속도 데이터 그래프(X/Y/Z축)
- 충격 이벤트 감지 및 하이라이트
- 영상 재생과 동기화
- 상세 분석을 위한 줌 및 팬

### 📁 파일 관리
- 이벤트 유형별 구성:
  - **일반**: 정기 연속 녹화
  - **충격**: 이벤트 트리거 녹화
  - **주차**: 주차 모드 녹화
- 색상으로 구분된 이벤트 유형
- 일괄 작업을 위한 다중 선택
- 검색 및 필터 기능

### ⚙️ 블랙박스 설정
- SD 카드에서 설정 읽기
- 앱 내에서 블랙박스 옵션 수정
- 설정을 SD 카드에 다시 저장
- 유효성 검사 및 오류 확인

### 🖼️ 이미지 처리
- 화면 캡처(현재 프레임을 이미지로 저장)
- 상세 보기를 위한 디지털 줌
- 수평/수직 반전
- 밝기 조정
- Metal GPU 가속으로 실시간으로 수행되는 모든 작업

### 🌍 다국어 지원
- 한국어(韓國語)
- 영어(English)
- 일본어(日本語) - 계획됨
- 확장 가능한 현지화 시스템

---

## 기술 하이라이트

### 네이티브 macOS 기술

```
┌─────────────────────────────────────────┐
│        macOS 네이티브 스택              │
├─────────────────────────────────────────┤
│ UI 계층      : SwiftUI + AppKit        │
│ 영상         : AVFoundation + FFmpeg   │
│ 그래픽       : Metal                   │
│ 지도         : MapKit / Google Maps    │
│ 차트         : Core Graphics           │
│ 파일 시스템  : FileManager + IOKit     │
│ 빌드         : Xcode + XcodeGen        │
└─────────────────────────────────────────┘
```

### 성능 특성

| 메트릭 | 목표 | 비고 |
|--------|------|------|
| 영상 재생 | 채널당 30fps 이상 | Metal 하드웨어 가속 |
| 동기화 정확도 | ±50ms | 전체 5개 채널 |
| 메모리 사용량 | < 2GB | 5개 1080p 스트림 |
| CPU 사용량 | < 80% | Apple Silicon |
| 앱 시작 | < 2초 | 콜드 스타트 |
| 내보내기 속도 | > 1x 실시간 | H.264+MP3 → MP4 |
| 프레임 캐시 적중률 | > 90% | 프레임 단위 이동 시 |
| 캐시 메모리 | ~250MB | 1080p RGBA 30프레임 |
| 시크 응답 시간 | < 100ms | 캐시 무효화 포함 |

### 아키텍처

애플리케이션은 명확하게 분리된 관심사를 가진 깔끔한 **MVVM(Model-View-ViewModel)** 아키텍처를 따릅니다:

```
┌──────────────────────────────────────────────────────┐
│                  프레젠테이션 계층                    │
│         SwiftUI Views + Metal Renderer               │
└──────────────────────────────────────────────────────┘
                        ↕
┌──────────────────────────────────────────────────────┐
│                 애플리케이션 계층                     │
│          View Models (ObservableObject)              │
└──────────────────────────────────────────────────────┘
                        ↕
┌──────────────────────────────────────────────────────┐
│                비즈니스 로직 계층                     │
│   Player • FileManager • GPS • GSensor • Export      │
└──────────────────────────────────────────────────────┘
                        ↕
┌──────────────────────────────────────────────────────┐
│                    데이터 계층                        │
│         FFmpeg Decoders • File System Access         │
└──────────────────────────────────────────────────────┘
```

### 메모리 관리 및 최적화

**프레임 캐싱 시스템:**
- 100ms 정밀도 캐시 키를 사용한 LRU 기반 캐시
- 30프레임 용량 (1080p 기준 ~250MB, 4K 기준 ~1GB)
- 5초마다 자동 캐시 정리 (현재 재생 위치 ±5초 범위 유지)
- 시크 작업 시 메모리 해제를 위한 캐시 무효화

**메모리 경고 처리:**
- 시스템 메모리 경고를 위한 NotificationCenter 관찰자
- 메모리 부족 상황에서 자동 캐시 정리
- 필요 시 최대 1GB 해제하여 앱 종료 방지
- 메모리 압력 상황에서도 재생 기능 유지

**성능 향상:**
- 프레임 단위 이동: 캐시 히트 시 즉각적인 응답 (0ms 디코딩)
- 반복 재생: 캐시된 프레임에 대해 10배 빠른 응답
- CPU 사용량 감소: 중복 FFmpeg 디코딩 작업 제거
- 메모리 효율성: 자동 정리로 무한 증가 방지

---

## 문서

포괄적인 문서는 `docs/` 디렉토리에서 확인할 수 있습니다:

| 문서 | 설명 |
|------|------|
| **[01_requirements_kr.md](docs/01_requirements_kr.md)** | 완전한 기능적 및 비기능적 요구사항 |
| **[02_technology_stack_kr.md](docs/02_technology_stack_kr.md)** | 상세한 기술 선택 및 근거 |
| **[03_architecture_kr.md](docs/03_architecture_kr.md)** | 시스템 아키텍처, 디자인 패턴 및 모듈 구조 |
| **[04_project_plan_kr.md](docs/04_project_plan_kr.md)** | 타임라인이 포함된 단계별 개발 계획 |
| **[05_technical_challenges_kr.md](docs/05_technical_challenges_kr.md)** | 주요 기술적 과제 및 상세 솔루션 |

---

## 기술 스택

### 핵심 기술

**애플리케이션 프레임워크:**
- **Swift 5.9+**: 주 프로그래밍 언어
- **SwiftUI**: 최신 선언형 UI 프레임워크
- **AppKit**: 창 관리 및 시스템 통합

**영상 처리:**
- **FFmpeg**: H.264 디코딩, MP3 음성, MP4 먹싱
- **AVFoundation**: 네이티브 영상 재생 및 동기화
- **Metal**: GPU 가속 렌더링 및 이미지 처리

**파일 시스템:**
- **FileManager**: 네이티브 파일 시스템 액세스
- **IOKit**: USB 장치 감지 및 관리

**지도:**
- **MapKit**: Apple의 네이티브 매핑 프레임워크(권장)
- **Google Maps SDK**: 더 풍부한 기능을 제공하는 대안

**데이터 시각화:**
- **Core Graphics**: G-센서 차트 렌더링
- **Swift Charts**: 최신 선언형 차팅(macOS 13+)

### 개발 도구

- **Xcode 15+**: IDE 및 빌드 시스템
- **Swift Package Manager**: 의존성 관리
- **CMake**: C/C++ 컴포넌트용 빌드 시스템
- **SwiftLint**: 코드 품질 및 스타일 검사
- **Instruments**: 성능 프로파일링
- **create-dmg**: macOS 설치 프로그램 생성

---

## 시스템 요구사항

### 개발 환경

**필수:**
- macOS 13.0(Ventura) 이상
- Xcode 15.0 이상
- Homebrew 패키지 관리자
- Apple Developer Program 멤버십(연 $99)

**하드웨어:**
- Apple Silicon(M1/M2/M3) 또는 Intel Core i7+ Mac
- 최소 16GB RAM, 32GB 권장
- 50GB 여유 저장 공간

### 대상 사용자

**최소:**
- macOS 12.0(Monterey) 이상
- 8GB RAM
- 100MB 여유 저장 공간(내보낸 영상용 공간 추가)

**권장:**
- macOS 13.0(Ventura) 이상
- 16GB RAM
- 최상의 성능을 위한 Apple Silicon Mac

---

## 프로젝트 타임라인

```
┌────────────────────────────────────────────────────────┐
│ 0단계: 준비                │ 1주                        │
│ 1단계: 파일 시스템 및 데이터│ 2-3주                      │
│ 2단계: 단일 재생            │ 2-3주                      │
│ 3단계: 다채널 동기화        │ 2-3주                      │
│ 4단계: 추가 기능            │ 2주                        │
│ 5단계: 내보내기 및 설정     │ 2주                        │
│ 6단계: 현지화 및 다듬기     │ 1-2주                      │
├────────────────────────────────────────────────────────┤
│ 총 기간                    │ 12-16주 (3-4개월)          │
└────────────────────────────────────────────────────────┘
```

### 마일스톤

**마일스톤 1: MVP** (3단계 종료)
- 파일 시스템 액세스 작동
- 다채널 동기화 재생 기능 작동
- 기본 재생 제어 구현

**마일스톤 2: 기능 완료** (5단계 종료)
- 모든 요구사항 구현
- GPS 매핑 및 G-센서 시각화 완료
- 내보내기 및 설정 관리 작동

**마일스톤 3: 프로덕션 준비** (6단계 종료)
- 현지화(한국어, 영어, 일본어)
- 다크 모드 지원이 포함된 세련된 UI
- 코드 서명 및 공증
- DMG 설치 프로그램 생성
- 문서 완료

---

## ⚠️ 현재 구현 상태

**최종 업데이트**: 2025-10-14

이 프로젝트는 현재 활발히 개발 중입니다. 다음은 구현 진행 상황을 요약한 것입니다:

### ✅ 완료된 단계 (Phase 1-4)

#### Phase 1: 파일 시스템 및 메타데이터 추출 ✅
**커밋**: f0981f7, 1fd70da, 60a418f

구현된 서비스:
- **FileScanner**: 비디오 파일 필터링을 통한 재귀 디렉토리 스캔
- **FileSystemService**: 파일 메타데이터 추출 및 디렉토리 작업
- **VideoFileLoader**: VideoDecoder를 통한 비디오 메타데이터 로딩 (동시 처리)
- **MetadataExtractor**: MP4 atom에서 GPS 및 가속도 데이터 추출

#### Phase 2: 비디오 디코딩 및 재생 제어 ✅
**커밋**: 083ba4d

구현된 서비스:
- **VideoDecoder** (1584줄): FFmpeg 통합, H.264/MP3 디코딩, 프레임별 탐색, 키프레임 기반 시크, BGRA 출력
- **MultiChannelSynchronizer**: 허용 오차 기반 프레임 정렬을 통한 다중 채널 타임스탬프 동기화

#### Phase 3: 다중 채널 동기화 ✅
**커밋**: 4712a30

구현된 서비스:
- **VideoBuffer** (신규): 스레드 안전 순환 버퍼 (최대 30 프레임), 타임스탬프 기반 검색
- **MultiChannelSynchronizer** (향상): 드리프트 모니터링 (100ms 간격), 자동 보정 (50ms 임계값), 드리프트 통계

#### Phase 4: GPS, G-센서 및 이미지 처리 ✅
**커밋**: 8b9232c

구현된 서비스:
- **GPSService** (1235줄): GPS 데이터 파싱, 타임스탬프 기반 쿼리, Haversine 계산, 속도/방향
- **GSensorService** (1744줄): 가속도 처리, 충격 감지, 이벤트 분류
- **FrameCaptureService** (415줄): 프레임 캡처 (PNG/JPEG), 메타데이터 오버레이, 다중 채널 합성
- **VideoTransformations** (1085줄): 밝기/대비, 반전, 줌, UserDefaults 지속성

### ⏳ 대기 중인 단계 (Phase 5)

#### Phase 5: Metal 렌더링 및 UI ⏳
**상태**: 시작 안 됨 (Xcode 빌드 환경 필요)

구현할 컴포넌트:
- **MetalRenderer**: 5개 채널을 위한 GPU 가속 비디오 렌더링
- **MapViewController**: GPS 경로 시각화를 위한 MapKit 통합
- **UI 계층**: SwiftUI/AppKit 뷰, 메뉴 액션, 키보드 단축키

### 🚀 주요 성과
- ✅ **파일 시스템**: 완전한 SD 카드 파일 스캔 및 메타데이터 추출
- ✅ **비디오 디코딩**: 프레임 단위 정확한 탐색을 통한 FFmpeg 통합
- ✅ **동기화**: ±50ms 정확도 및 드리프트 보정을 통한 5채널 동기화
- ✅ **GPS 및 G-센서**: 파싱에서 처리까지 전체 데이터 파이프라인
- ✅ **이미지 처리**: 스크린샷 캡처 및 비디오 변환

### 📊 전체 진행 상황
- **Phase 1-4**: 100% 완료 (핵심 백엔드 서비스)
- **Phase 5**: 0% 완료 (Metal 렌더링 및 UI 계층)
- **전체**: 백엔드 약 80% 완료, UI 계층 대기 중

자세한 구현 상태는 [IMPLEMENTATION_CHECKLIST.md](IMPLEMENTATION_CHECKLIST.md)를 참조하세요.

---

## 시작하기

### 전제 조건

```bash
# Homebrew 설치(아직 설치하지 않은 경우)
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# 개발 도구 설치
brew install ffmpeg cmake git git-lfs swiftlint

# Xcode 명령줄 도구 설치
xcode-select --install
```

### 초기 설정

1. **저장소 복제**(생성 시)
   ```bash
   git clone https://github.com/your-org/blackbox-player.git
   cd blackbox-player
   ```

2. **Xcode에서 열기**
   ```bash
   open BlackboxPlayer.xcodeproj
   ```

3. **코드 서명 구성**
   - Xcode에서 프로젝트 선택
   - "Signing & Capabilities"로 이동
   - 개발 팀 선택
   - 번들 식별자 확인

4. **빌드 및 실행**
   - `Cmd+R`을 누르거나 실행 버튼 클릭
   - 대상 장치 선택(내 Mac)

### 샘플 데이터로 테스트

1. 샘플 블랙박스 SD 카드를 얻거나 제공된 테스트 데이터 사용
2. USB 카드 리더기를 통해 SD 카드 연결
3. 애플리케이션 시작
4. 장치 선택기에서 SD 카드 장치 선택
5. 영상 탐색 및 재생

---

## 프로젝트 구조

```
blackbox_player/
├── README_kr.md                # 이 파일
├── docs/                       # 상세 문서
│   ├── 01_requirements_kr.md
│   ├── 02_technology_stack_kr.md
│   ├── 03_architecture_kr.md
│   ├── 04_project_plan_kr.md
│   └── 05_technical_challenges_kr.md
├── BlackboxPlayer/             # 메인 애플리케이션(생성 예정)
│   ├── App/
│   │   ├── BlackboxPlayerApp.swift
│   │   └── AppDelegate.swift
│   ├── Views/
│   │   ├── ContentView.swift
│   │   ├── Player/
│   │   ├── FileList/
│   │   ├── Map/
│   │   ├── Charts/
│   │   └── Settings/
│   ├── ViewModels/
│   │   ├── PlayerViewModel.swift
│   │   ├── FileListViewModel.swift
│   │   └── SettingsViewModel.swift
│   ├── Services/
│   │   ├── VideoPlayerService.swift
│   │   ├── FileManagerService.swift
│   │   ├── ExportService.swift
│   │   ├── GPSService.swift
│   │   └── GSensorService.swift
│   ├── Models/
│   │   ├── VideoFile.swift
│   │   ├── VideoMetadata.swift
│   │   ├── GPSPoint.swift
│   │   └── AccelerationData.swift
│   ├── Utilities/
│   │   ├── FFmpegWrapper.swift
│   │   └── MetalRenderer.swift
│   ├── Resources/
│   │   ├── Assets.xcassets
│   │   ├── Localizable.strings
│   │   └── Info.plist
├── Tests/
│   ├── UnitTests/
│   ├── IntegrationTests/
│   └── UITests/
└── scripts/
    ├── build.sh
    ├── sign.sh
    └── notarize.sh
```

---

## 개발 단계

### 0단계: 준비(1주차)
**목표:** 개발 환경 설정 및 기술적 타당성 검증

**주요 작업:**
- ✅ Xcode 프로젝트 설정
- ✅ FFmpeg 통합 및 테스트
- ✅ 샘플 데이터 수집 및 분석
- ✅ 기본 개념 증명

### 1단계: 파일 시스템 및 데이터 계층(2-4주차)
**목표:** 파일 시스템 액세스 및 메타데이터 파싱 구현

**주요 작업:**
- 파일 시스템 서비스 구현
- USB 장치 감지 및 마운트
- 파일 열거 및 읽기
- GPS 및 G-센서 메타데이터 파싱
- 기본 파일 목록 UI

### 2단계: 단일 채널 재생(5-7주차)
**목표:** 부드러운 단일 영상 재생 구현

**주요 작업:**
- FFmpeg H.264/MP3 디코딩
- Metal 렌더러 설정
- 영상 플레이어 뷰
- 재생 제어(재생, 일시정지, 탐색, 속도)
- 음성/영상 동기화

### 3단계: 다채널 동기화(8-10주차)
**목표:** 프레임 단위 정확도로 5개 채널 동기화

**주요 작업:**
- 다채널 아키텍처
- 마스터 클럭 구현
- 드리프트 모니터링이 포함된 동기화 컨트롤러
- 멀티 텍스처 Metal 렌더링
- 레이아웃 관리자(그리드, 포커스, 수평)
- 성능 최적화

### 4단계: 추가 기능(11-12주차)
**목표:** GPS, G-센서 및 이미지 처리 구현

**주요 작업:**
- GPS 서비스 및 지도 통합
- G-센서 차트 시각화
- 화면 캡처 기능
- 영상 변환(반전, 밝기, 줌)
- 전체 화면 모드

### 5단계: 내보내기 및 설정(13-14주차)
**목표:** MP4 내보내기 및 블랙박스 설정

**주요 작업:**
- FFmpeg 먹싱을 사용한 MP4 내보내기
- 영상 복구 기능
- 채널 추출
- 설정 파일 파서
- 설정 UI 및 유효성 검사

### 6단계: 현지화 및 다듬기(15-16주차)
**목표:** 프로덕션 준비 애플리케이션

**주요 작업:**
- 문자열 현지화(한국어, 영어, 일본어)
- 다크 모드 지원
- UI/UX 다듬기
- 성능 튜닝
- 코드 서명 및 공증
- DMG 설치 프로그램 생성
- 문서

---

## 기여하기

현재 비공개 개발 프로젝트입니다. 프로젝트가 외부 기여자에게 공개되면 기여 가이드라인이 추가될 것입니다.

### 개발 워크플로우

1. `develop`에서 기능 브랜치 생성
2. Swift 스타일 가이드를 따라 변경 사항 구현
3. 새로운 기능에 대한 단위 테스트 추가
4. `swiftlint`를 실행하여 코드 품질 확인
5. 상세한 설명과 함께 풀 리퀘스트 제출
6. 코드 리뷰 및 자동화 테스트 통과
7. 승인 후 `develop`에 병합

### 코드 표준

- **Swift 스타일**: [Swift.org API Design Guidelines](https://swift.org/documentation/api-design-guidelines/) 준수
- **커밋 메시지**: 관례적 커밋 형식 사용: `type(scope): description`
- **테스트 커버리지**: >80% 코드 커버리지 유지
- **문서**: 명확한 설명과 예제로 모든 공용 API 문서화

---

## 라이선스

**독점 - 모든 권리 보유**

이 프로젝트는 [회사명]을 위해 개발된 독점 소프트웨어입니다. 무단 복사, 배포 또는 수정은 엄격히 금지됩니다.

Copyright © 2024 [회사명]. 모든 권리 보유.

---

## 연락처

질문이나 지원이 필요하면 다음으로 연락하세요:

- **프로젝트 리더**: [이름] - [email@example.com]
- **기술 리더**: [이름] - [email@example.com]
- **제품 관리자**: [이름] - [email@example.com]

---

## 감사의 말

- **Apple Developer Documentation**: 포괄적인 macOS 개발 리소스 제공
- **FFmpeg 팀**: 뛰어난 영상 처리 라이브러리 제공

---

## 로드맵

### 버전 1.0(초기 릴리스)
- ✅ 요구사항에 설명된 모든 기능
- ✅ 한국어 및 영어 현지화
- ✅ 프로덕션 준비 빌드

### 버전 1.1(2024년 2분기)
- 추가 언어 지원(일본어, 중국어)
- 사용자 피드백 기반 성능 개선
- 버그 수정 및 안정성 개선

### 버전 2.0(2024년 4분기)
- iOS 컴패니언 앱
- 설정 및 북마크용 iCloud 동기화
- 블랙박스에서 라이브 스트리밍(Wi-Fi 지원 모델)
- AI 기반 이벤트 감지
- 고급 영상 편집 기능
- 클라우드 스토리지 통합

---

**macOS를 위해 ❤️로 제작**

마지막 업데이트: 2025-10-14
프로젝트 상태: Phase 1-4 완료 (백엔드 서비스) | Phase 5 대기 중 (UI 계층)
